# Introduction to Python APIs on GCP


## Let's get started!

This guide will show you how to deploy out your python code through a HTTP Rest API.  
This tutorial uses [FastAPI](https://fastapi.tiangolo.com/) as the backend framework and docker for containerization. In addition, we run through how to use [Cloud Build](https://cloud.google.com/build) to build and vulnerbility scan the resulting container.

**Time to complete**: About 15 minutes

Click the **Start** button to move to the next step.

## FastAPI 

[FastAPI](https://fastapi.tiangolo.com/) is a python framework that makes it easy to build Rest APIs.  
It is built on top of ASGI (Asynchronous Server Gateway Interface), which allows it to handle concurrency natively and hence quicker response times. 

In addition, FastAPI provides autogenerated documentation for your API on `/docs` endpoint.

Next we'll look at creating endpoints using FastAPI.

## Creating endpoints with FastAPI

Go to [`api.py`](/home/${USER}/cloudshell_open/python-api-template/api.py). This file initialises the FastAPI client and then creates an example healthcheck endpoint.

To create an endpoint:
```python
@app.get(YOUR_ENDPOINT_PATH)
async def your_endpoint_function():
    ...
```

Further reading: [FastAPI documentation](https://fastapi.tiangolo.com/tutorial/first-steps/)


## Containerising your application

We use [Docker](https://www.docker.com/) to containerise our application. See the [Dockerfile](/home/${USER}/cloudshell_open/python-api-template/Dockerfile) for more information.

To build and run our container application locally:  
```bash
cd /home/${USER}/cloudshell_open/python-api-template

docker build -t python-api:local .

docker run -p 5000:5000 python-api:local
```

## Step 4: Cloud Build & Vulnerability Scanning

We can then use [Cloud Build](https://cloud.google.com/build) to build our docker image, run a vulnerability scan and if successful, store in [Artifact Registry](https://cloud.google.com/artifact-registry/docs/overview).

```bash
cd /home/${USER}/cloudshell_open/python-api-template

export PROJECT_ID={YOUR_PROJECT_ID}

gcloud builds submit \
 --config=/home/${USER}/cloudshell_open/python-api-template/cloudbuild/container_build.yml \
 --timeout=3600 \
 --substitutions=_IMAGE_VERSION=local \
 --project=${PROJECT_ID}
```

We use [Kritis](https://github.com/grafeas/kritis) in the `vulnsign` stage of our [cloudbuild config](/home/${USER}/cloudshell_open/python-api-template/cloudbuild/container_build.yml).  
This does vulnerbility policy enforcement using the [policy.yaml](/home/${USER}/cloudshell_open/python-api-template/policy.yaml).

Further reading and how to create attestations for binary auth: [Kritis Signer documentation](https://cloud.google.com/binary-authorization/docs/creating-attestations-kritis)


## Congratulations

<walkthrough-conclusion-trophy></walkthrough-conclusion-trophy>

Youâ€™re all set!

The API can now be deployed on any service that accepts containers.  
For example, [Google Kubernetes Engine](https://cloud.google.com/kubernetes-engine/docs) or [Cloud Run](https://cloud.google.com/run/docs/quickstart).


